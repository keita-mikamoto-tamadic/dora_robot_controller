nodes:
  # IMU Node - Spresense IMU serial communication (1ms push)
  - id: imu_node
    path: cpp/sensor/imu/sony/imu_node
    inputs:
      tick: dora/timer/millis/1
    outputs:
      - imu_data
    env:
      LD_LIBRARY_PATH: "${PWD}/lib"

  # Robot Control GUI - state machine control interface (dynamic node)
  # Start with: ROBOT_CONFIG=robot_config/mimic_v2.json python3 python/gui/robot_control/robot_control_gui.py
  - id: robot_control_gui
    path: dynamic
    inputs:
      state_status: mimicv2_state_manager/state_status
      motor_display: mimicv2_state_manager/motor_display
      imu_data: imu_node/imu_data
      cycle_time_us: moteus_driver/cycle_time_us
    outputs:
      - robot_config
      - state_command

  # State Manager - state machine for robot control
  - id: mimicv2_state_manager
    path: cpp/state_machine/mimicv2_state_manager/mimicv2_state_manager_node
    inputs:
      tick: dora/timer/millis/5
      robot_config: robot_control_gui/robot_config
      motor_status: moteus_driver/motor_status
      state_command: robot_control_gui/state_command
      imu_data: imu_node/imu_data
    outputs:
      - robot_config_out
      - motor_commands
      - state_status
      - motor_display
      - set_position
    env:
      LD_LIBRARY_PATH: "${PWD}/lib"

  # Moteus Driver - unified motor control (protocol + CAN)
  - id: moteus_driver
    path: cpp/motor/moteus_driver/moteus_driver_node
    inputs:
      robot_config: mimicv2_state_manager/robot_config_out
      motor_commands: mimicv2_state_manager/motor_commands
      set_position: mimicv2_state_manager/set_position
    outputs:
      - motor_status
      - cycle_time_us
    env:
      LD_LIBRARY_PATH: "${PWD}/lib"
      CAN_INTERFACE: "can0"
      RX_TIMEOUT_US: "4000"
      CPU_AFFINITY: "1"
      RT_PRIORITY: "80"
